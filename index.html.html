<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SayGM Testnet</title>
<script src="https://cdn.jsdelivr.net/npm/ethers@6.8.0/dist/ethers.min.js"></script>
<style>
body { 
    font-family: Arial, sans-serif; 
    padding: 20px; 
    background: #f0f4f8; 
    color: #0d1b2a;
}

h1, h2 { color: #1e3a8a; }

input, textarea { 
    width: 100%; 
    padding: 10px; 
    margin-top: 5px; 
    border: 1px solid #1e3a8a; 
    border-radius: 6px;
    background: #ffffff;
    color: #0d1b2a;
    font-size: 16px;
}

button { 
    padding: 12px 25px; 
    margin-top: 10px; 
    cursor: pointer; 
    border: none;
    border-radius: 6px;
    background: #1e3a8a; /* deep blue */
    color: #ffffff;
    font-size: 16px;
    transition: background 0.3s;
}

button:hover {
    background: #3b5bdb; /* lighter blue on hover */
}

#leaderboard { 
    margin-top: 20px; 
    background:#ffffff; 
    padding: 15px; 
    border-radius: 10px; 
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

#leaderboard div {
    padding: 6px 0;
    border-bottom: 1px solid #e0e7ff;
}

#leaderboard div:last-child {
    border-bottom: none;
}
</style>
</head>
<body>

<h1>SayGM Testnet</h1>

<p>Send a GM and climb the leaderboard!</p>

<input id="gmMessage" placeholder="Type your GM message..." />
<button id="sendGM">Send GM</button>

<h2>Leaderboard</h2>
<div id="leaderboard"></div>

<script>
// ðŸŸ¢ CONTRACT SETTINGS
const contractAddress = "0x23ab4815ceADF585AE0e925DF082974493ba1312"; // áƒ¨áƒ”áƒªáƒ•áƒáƒšáƒ” áƒ¨áƒ”áƒœáƒ¡ DEPLOY CONTRACT ADDRESS
const contractABI = [
  "function sayGM(string message) external payable",
  "function getTopUsers(uint256 n) external view returns (tuple(address user,uint256 currentStreak,uint256 longestStreak,uint256 totalGMs)[])",
  "function gmFee() external view returns (uint256)"
];

let provider, signer, contract;

async function init() {
    if (window.ethereum) {
        try {
            await window.ethereum.request({ method: "eth_requestAccounts" });
            provider = new ethers.JsonRpcProvider(window.ethereum);
            signer = provider.getSigner();
            contract = new ethers.Contract(contractAddress, contractABI, signer);
            updateLeaderboard();
        } catch (err) {
            console.error("Wallet connection failed", err);
            alert("Wallet connection failed. See console.");
        }
    } else {
        alert("Please install MetaMask or compatible wallet.");
    }
}

async function sendGM() {
    const message = document.getElementById("gmMessage").value;
    if (!message) return alert("Type a GM message!");

    try {
        const fee = await contract.gmFee(); // get current fee from contract
        const tx = await contract.sayGM(message, { value: fee });
        await tx.wait(); // wait for transaction confirmation
        alert("GM sent! âœ…");
        updateLeaderboard();
    } catch (err) {
        console.error("Transaction failed", err);
        alert("Transaction failed. See console.");
    }
}

async function updateLeaderboard() {
    try {
        const top = await contract.getTopUsers(10);
        const container = document.getElementById("leaderboard");
        container.innerHTML = "";
        top.forEach((u,i)=>{
            const div = document.createElement("div");
            div.textContent = `${i+1}. ${u.user} | Streak: ${u.currentStreak} | Longest: ${u.longestStreak} | Total GMs: ${u.totalGMs}`;
            container.appendChild(div);
        });
    } catch(err) {
        console.error("Leaderboard fetch failed", err);
    }
}

document.getElementById("sendGM").onclick = sendGM;

// Init on page load
init();
</script>

</body>
</html>